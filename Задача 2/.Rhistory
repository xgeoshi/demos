knitr::opts_chunk$set(echo = TRUE)
require(data.table)
csv2.path <- "data.csv" #datafile path
df.test2  <- read.csv2(csv2.path, stringsAsFactors = FALSE,
fileEncoding = "windows-1251")[, 1:3]
dt.test2  <- as.data.table(df.test2) #Data Frame to data.table
names(dt.test2) <- c("case_id", "part1", "part2") #Columns rename
dt.test2
test2.tidy <- data.table::melt(dt.test2, id = 1)
test2.tidy
accid.num <- test2.tidy[, .(case_id, cases_ttl = .N), by = value][]
accid.num
cast.accid <- dcast(accid.num, case_id ~ cases_ttl, fun.aggregate = length)
cast.accid
cast.accid[cast.accid$"1" == 2, "fraud" := "Low"]
cast.accid[cast.accid$"1" == 1, "fraud" := "Medium"]
cast.accid[cast.accid$"1" == 0, "fraud" := "High"]
# Merge fraud ranking with with total_cases
dt.full <- merge(accid.num, cast.accid, by = "case_id")
dt.full
# List of names with high fraud suspicion
dt.suspicion <- dt.full[fraud == "High", .(name = unique(value))]
dt.suspicion
dt.test2[unique(dt.full[fraud == "High"]$case_id)]
